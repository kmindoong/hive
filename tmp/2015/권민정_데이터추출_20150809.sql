SELECT /*+ parallel(A 16) */ A.STRD_YM
     , (SELECT WAT_TMS_RNG_NM FROM VM_WAT_TMS_RNG AA WHERE AA.WAT_TMS_RNG_CD = A.WAT_TMS_RNG_CD) AS WAT_TMS_RNG_NM
     , SUM(A.WAT_CNT_M) AS "시청건수"
 FROM CT_MBL_VOD_WAT_PRST_MONTH A 
WHERE A.STRD_YM BETWEEN '201401' AND '201507'
GROUP BY A.STRD_YM
       , A.WAT_TMS_RNG_CD
ORDER BY A.STRD_YM
       , A.WAT_TMS_RNG_CD
;

SELECT /*+ parallel(A 16) */ A.STRD_YM
     , (SELECT WAT_TMS_RNG_NM FROM VM_WAT_TMS_RNG AA WHERE AA.WAT_TMS_RNG_CD = A.WAT_TMS_RNG_CD) AS WAT_TMS_RNG_NM
     , SUM(A.WAT_CNT_M) AS "시청건수"
 FROM CT_MBL_RLTMWAT_PRST_MONTH A 
WHERE A.STRD_YM BETWEEN '201401' AND '201507'
GROUP BY A.STRD_YM
       , A.WAT_TMS_RNG_CD
ORDER BY A.STRD_YM
       , A.WAT_TMS_RNG_CD
;

-- 가입자 대비 사용자수
SELECT A.STRD_YM
     , COUNT(DISTINCT A.MBL_CUST_NUM) AS SCRB_CNT
     , SUM(CASE WHEN B.MBL_CUST_NUM IS NOT NULL THEN 1 ELSE 0 END) AS USER_CNT
     , SUM(CASE WHEN C.MBL_CUST_NUM IS NOT NULL THEN 1 ELSE 0 END) AS BILL_CNT
  FROM CC_MBL_CUST_SVC_PRST_MONTH A
  LEFT OUTER JOIN 
       (SELECT /*+ parallel(A 16) */ STRD_YM, MBL_CUST_NUM
          FROM CT_MBL_RLTMWAT_PRST_MONTH A
         WHERE STRD_YM BETWEEN '201401' AND '201507'
           AND MBL_CUST_NUM LIKE 'U%'
         GROUP BY STRD_YM, MBL_CUST_NUM
         UNION
        SELECT /*+ parallel(B 16) */ STRD_YM, MBL_CUST_NUM
          FROM CT_MBL_VOD_WAT_PRST_MONTH B
         WHERE STRD_YM BETWEEN '201401' AND '201507'
           AND MBL_CUST_NUM LIKE 'U%'
         GROUP BY STRD_YM, MBL_CUST_NUM
       ) B
    ON A.STRD_YM = B.STRD_YM
   AND A.MBL_CUST_NUM = B.MBL_CUST_NUM
  LEFT OUTER JOIN
       (SELECT /*+ parallel(C 16) */ STRD_YM, MBL_CUST_NUM
          FROM CT_MBL_BUY_FIX_DTL C
         WHERE STRD_YM BETWEEN '201401' AND '201507'
           AND MBL_CUST_NUM LIKE 'U%'
           AND BUY_CNCL_YN = 'N'
           AND BUY_AMT > 0
         GROUP BY STRD_YM, MBL_CUST_NUM
       ) C
    ON A.STRD_YM = C.STRD_YM
   AND A.MBL_CUST_NUM = C.MBL_CUST_NUM
 WHERE A.STRD_YM BETWEEN '201401' AND '201507'
 GROUP BY A.STRD_YM
 ORDER BY A.STRD_YM
;


SELECT A.STRD_YM
, (SELECT SEX_NM FROM VM_SEX AA WHERE AA.SEX_CD = A.SEX_CD) AS SEX_NM
, (SELECT AGE_RNG_NM FROM VM_AGE_RNG AA WHERE AA.AGE_RNG_CD = A.AGE_RNG_CD) AS AGE_RNG_NM
    , COUNT(DISTINCT A.MBL_CUST_NUM) AS "가입자수"
    , SUM(BUY_AMT) AS "구매금액"
  FROM CC_MBL_CUST_SVC_PRST_MONTH A
  JOIN CT_MBL_BUY_FIX_DTL C
    ON A.STRD_YM = C.STRD_YM
   AND A.MBL_CUST_NUM = C.MBL_CUST_NUM
 WHERE A.STRD_YM BETWEEN '201401' AND '201506'
   AND C.BUY_CNCL_YN = 'N'
 GROUP BY A.STRD_YM
     , SEX_CD
     , AGE_RNG_CD
 ORDER BY A.STRD_YM
     , SEX_CD
     , AGE_RNG_CD
;
 
-- 모바일 실시간 요금제별 사용자수
SELECT /*+ parallel(A 16) */ A.STRD_YM, B.SKT_PRCPLN_CD, A.MBL_CONN_CL_CD
     , COUNT(DISTINCT B.MBL_CUST_NUM) AS "가입자수", SUM(A.WAT_CNT_M) AS "시청건수"
 FROM CT_MBL_RLTMWAT_PRST_MONTH A 
 JOIN CC_MBL_CUST_SVC_PRST_MONTH B
   ON A.STRD_YM = B.STRD_YM
  AND A.MBL_CUST_NUM = B.MBL_CUST_NUM
GROUP BY A.STRD_YM, B.SKT_PRCPLN_CD, A.MBL_CONN_CL_CD
ORDER BY A.STRD_YM, B.SKT_PRCPLN_CD, A.MBL_CONN_CL_CD;

-- 모바일 VOD 패턴
SELECT /*+ parallel(A 16) */ A.STRD_YM, B.SKT_PRCPLN_CD
     , COUNT(DISTINCT B.MBL_CUST_NUM) AS "가입자수", SUM(A.WAT_CNT_M) AS "시청건수"
 FROM CT_MBL_VOD_WAT_PRST_MONTH A 
 JOIN CC_MBL_CUST_SVC_PRST_MONTH B
   ON A.STRD_YM = B.STRD_YM
  AND A.MBL_CUST_NUM = B.MBL_CUST_NUM
WHERE A.STRD_YM BETWEEN '201401' AND '201507'
GROUP BY A.STRD_YM, B.SKT_PRCPLN_CD
ORDER BY A.STRD_YM, B.SKT_PRCPLN_CD;

-- 모바일 VOD
SELECT A.STRD_YM
, (SELECT SEX_NM FROM VM_SEX AA WHERE AA.SEX_CD = A.SEX_CD) AS SEX_NM
, (SELECT AGE_RNG_NM FROM VM_AGE_RNG AA WHERE AA.AGE_RNG_CD = A.AGE_RNG_CD) AS AGE_RNG_NM
     , (CASE WHEN PYFR_MBR_CL_CD = 'T9C' THEN '유료'
             WHEN PYFR_MBR_CL_CD = 'T9F' THEN '무료'
             WHEN PYFR_MBR_CL_CD = 'T9B' THEN '무료_B포인트쿠폰'
             WHEN PYFR_MBR_CL_CD = 'T9T' THEN '무료_T프리미엄'
             ELSE '기타'
         END) AS PYFR_MBR_CL_NM
     , (SELECT WAT_TMS_RNG_NM FROM VM_WAT_TMS_RNG AA WHERE AA.WAT_TMS_RNG_CD = B.WAT_TMS_RNG_CD) AS WAT_TMS_RNG_NM
     , COUNT(DISTINCT A.MBL_CUST_NUM) AS "가입자수"
     , SUM(WAT_CNT_M) AS "시청건수"
  FROM CC_MBL_CUST_SVC_PRST_MONTH A
  JOIN CT_MBL_VOD_WAT_PRST_MONTH B
    ON A.STRD_YM = B.STRD_YM
   AND A.MBL_CUST_NUM = B.MBL_CUST_NUM
 WHERE A.STRD_YM BETWEEN '201401' AND '201506'
 GROUP BY A.STRD_YM
     , SEX_CD
     , AGE_RNG_CD
     , PYFR_MBR_CL_CD
     , WAT_TMS_RNG_CD
 ORDER BY A.STRD_YM
     , SEX_CD
     , AGE_RNG_CD
     , PYFR_MBR_CL_CD
     , WAT_TMS_RNG_CD
;


SELECT A.STRD_YM, B.SKT_PRCPLN_CD, A.MBL_CONN_CL_CD, COUNT(*)
 FROM CT_MBL_RLTMWAT_PRST_MONTH A 
 JOIN CC_MBL_CUST_SVC_PRST_MONTH B
   ON A.STRD_YM = B.STRD_YM
  AND A.MBL_CUST_NUM = B.MBL_CUST_NUM
GROUP BY A.STRD_YM, B.SKT_PRCPLN_CD, A.MBL_CONN_CL_CD;

 
SELECT STRD_YM
     , (SELECT SEX_NM FROM VM_SEX AA WHERE AA.SEX_CD = A.SEX_CD) AS SEX_NM
     , (SELECT AGE_RNG_NM FROM VM_AGE_RNG AA WHERE AA.AGE_RNG_CD = A.AGE_RNG_CD) AS AGE_RNG_NM
     , (CASE WHEN PYFR_MBR_CL_CD = 'T9C' THEN '유료'
             WHEN PYFR_MBR_CL_CD = 'T9F' THEN '무료'
             WHEN PYFR_MBR_CL_CD = 'T9B' THEN '무료_B포인트쿠폰'
             WHEN PYFR_MBR_CL_CD = 'T9T' THEN '무료_T프리미엄'
             ELSE '기타'
         END) AS PYFR_MBR_CL_NM
     , BTV_CNNT_SCRB_YN
     , (SELECT CUSTGRP_CL_NM FROM VM_CUSTGRP_CL AA WHERE AA.CUSTGRP_CL_CD = A.CUSTGRP_CL_CD) AS CUSTGRP_CL_NM
     , COUNT(*)
  FROM CC_MBL_CUST_SVC_PRST_MONTH A
 GROUP BY STRD_YM
     , SEX_CD
     , AGE_RNG_CD
     , PYFR_MBR_CL_CD
     , BTV_CNNT_SCRB_YN
     , CUSTGRP_CL_CD
 ORDER BY STRD_YM
     , SEX_CD
     , AGE_RNG_CD
     , PYFR_MBR_CL_CD
     , BTV_CNNT_SCRB_YN
     , CUSTGRP_CL_CD
;
 
SELECT * FROM VM_PYFR_MBR_CL;
 
SELECT MBL_PROD_TYP_CD FROM CT_CNTNTS_MST WHERE ;

SELECT BTV_BTVM_CL_CD, COUNT(*) FROM CT_TV_PROD_MST PARTITION (PT_20150715) GROUP BY BTV_BTVM_CL_CD;

SELECT BTV_BTVM_CL_CD
     , (SELECT PROD_TYP_NM FROM VM_PROD_TYP AA WHERE AA.PROD_TYP_CD = A.PROD_TYP_CD) AS PROD_TYP_NM
     , COUNT(*)
  FROM CT_TV_PROD_MST PARTITION (PT_20150715) A
 GROUP BY BTV_BTVM_CL_CD
        , PROD_TYP_CD
 ORDER BY BTV_BTVM_CL_CD
        , PROD_TYP_CD
;

SELECT CTG_CL_CD, COUNT(*)
  FROM CT_CNTNTS_MST PARTITION (PT_20150715)
 GROUP BY CTG_CL_CD;

SELECT CTG_CL_CD, COUNT(*)
  FROM CT_CNTNTS_MST PARTITION (PT_20150101)
 GROUP BY CTG_CL_CD;

SELECT CTG_CL_CD, COUNT(*)
  FROM CT_CNTNTS_MST PARTITION (PT_20140101)
 GROUP BY CTG_CL_CD;


SELECT * FROM CT_CNTNTS_DTL WHERE STRD_DT = '20150630';

SELECT A.STRD_YM
     , (SELECT MTH_CHNP_CL_NM FROM VM_MTH_CHNP_CL AA WHERE AA.MTH_CHNP_CL_CD=A.MTH_CHNP_CL_CD) AS MTH_CHNP_CL_NM
     , (SELECT MAIN_MTH_FIXAMT_CL_NM FROM VM_MAIN_MTH_FIXAMT_CL AA WHERE AA.MAIN_MTH_FIXAMT_CL_CD=A.MAIN_MTH_FIXAMT_CL_CD) AS MAIN_MTH_FIXAMT_CL_NM
     , (SELECT CHNL_PACK_CL_NM FROM VM_CHNL_PACK_CL AA WHERE AA.CHNL_PACK_CL_CD=A.CHNL_PACK_CL_CD) AS CHNL_PACK_CL_NM
     , B.CUST_TYP_CD
     , B.CUST_LIFESTG_CL_CD
     , COUNT(*)
  FROM CT_PPM_SCRB_DTL_TOT_MONTH A
  JOIN CC_SVC_PRST_MONTH B
    ON A.SVC_MGMT_NUM = B.SVC_MGMT_NUM
   AND A.STRD_YM = B.STRD_YM
 WHERE MTH_CHNP_CL_CD != '#'
 GROUP BY A.STRD_YM
     , MTH_CHNP_CL_CD
     , MAIN_MTH_FIXAMT_CL_CD
     , CHNL_PACK_CL_CD
     , B.CUST_TYP_CD
     , B.CUST_LIFESTG_CL_CD
 ORDER BY A.STRD_YM
     , MTH_CHNP_CL_CD
     , MAIN_MTH_FIXAMT_CL_CD
     , CHNL_PACK_CL_CD
     , B.CUST_TYP_CD
     , B.CUST_LIFESTG_CL_CD
;


SELECT STRD_YM
     , MSTB_YN
     , IDX_CTG_CL_CD
     , PPC_BUY_AMT
     , PPC_BUYR_CNT
     , PPV_PPS_BUYR_CNT
     , WATR_CNT
     , WAT_CNT
     , WAT_TMS
  FROM CT_CTG_HIT_BUY_WAT_ANALS
 ORDER BY STRD_YM
        , MSTB_YN
        , IDX_CTG_CL_CD
;


SELECT * FROM CT_VCG_MST;

SELECT STRD_YM
     , VCG_CD
     , COUNT(*)
  FROM CT_VOD_CSWT
 GROUP BY STRD_YM
        , VCG_CD;
        
        
SELECT STRD_YM
     , VCG_CD
     , COUNT(*)
  FROM CT_VOD_CCWT
 GROUP BY STRD_YM
        , VCG_CD;

SELECT *
FROM (
SELECT STRD_YM
     , DWH_CL_CD
     , WAT_CNT
     , ROW_NUMBER () OVER (PARTITION BY STRD_YM ORDER BY WAT_CNT DESC) AS RNK
  FROM (SELECT STRD_YM
             , DWH_CL_CD
             , SUM(WAT_CNT) AS WAT_CNT
         FROM CT_TV_NEEDS_SEG_VOD_ANALS
        GROUP BY STRD_YM
             , DWH_CL_CD
       ) A
)
WHERE RNK <4
;

SELECT * FROM CT_IPTV_PROD_USE_TYP_ANALS;

SELECT * FROM CT_RLTM_GRP_PREFR_ANALS;

SELECT * 
  FROM CT_TV_NEEDS_SEG
 GROUP BY STRD_YM
        , CUST_LIFESTG_CL_CD
        , SVC_LAST_USE_MTH_CNT_RNG_CD;

SELECT * FROM CT_CNTNTS_MST_DV PARTITION (PT_20150630);

SELECT * FROM CT_CNTNTS_DTL;

SELECT * FROM CT_CNTNTS_MST PARTITION (PT_20150715) WHERE VCG_CD ='1000000162';


SELECT STRD_YM
     , (SELECT MBL_PROD_TYP_NM FROM VM_MBL_PROD_TYP AA WHERE A.MBL_PROD_TYP_CD = AA.MBL_PROD_TYP_CD) AS MBL_PROD_TYP_NM
     , COUNT(*) AS BUY_CNT
     , SUM(BUY_AMT)
  FROM CT_MBL_BUY_FIX_DTL A
 GROUP BY STRD_YM
        , MBL_PROD_TYP_CD
 ORDER BY STRD_YM
        , MBL_PROD_TYP_CD
;



SELECT A.STRD_YM
     , (SELECT SEX_NM FROM VM_SEX AA WHERE AA.SEX_CD = A.SEX_CD) AS SEX_NM
     , (SELECT AGE_RNG_NM FROM VM_AGE_RNG AA WHERE AA.AGE_RNG_CD = A.AGE_RNG_CD) AS AGE_RNG_NM
     , (CASE WHEN PYFR_MBR_CL_CD = 'T9C' THEN '유료'
             WHEN PYFR_MBR_CL_CD = 'T9F' THEN '무료'
             WHEN PYFR_MBR_CL_CD = 'T9B' THEN '무료_B포인트쿠폰'
             WHEN PYFR_MBR_CL_CD = 'T9T' THEN '무료_T프리미엄'
             ELSE '기타'
         END) AS PYFR_MBR_CL_NM
     , BTV_CNNT_SCRB_YN
     , (SELECT CUSTGRP_CL_NM FROM VM_CUSTGRP_CL AA WHERE AA.CUSTGRP_CL_CD = A.CUSTGRP_CL_CD) AS CUSTGRP_CL_NM
     , (SELECT MBL_PROD_TYP_NM FROM VM_MBL_PROD_TYP AA WHERE B.MBL_PROD_TYP_CD = AA.MBL_PROD_TYP_CD) AS MBL_PROD_TYP_NM
     , SUM(BUY_AMT)
     , COUNT(*) AS BUY_CNT
  FROM CC_MBL_CUST_SVC_PRST_MONTH A
  JOIN CT_MBL_BUY_FIX_DTL B
    ON A.STRD_YM = B.STRD_YM
   AND A.MBL_CUST_NUM = B.MBL_CUST_NUM
 GROUP BY A.STRD_YM
     , SEX_CD
     , AGE_RNG_CD
     , PYFR_MBR_CL_CD
     , BTV_CNNT_SCRB_YN
     , CUSTGRP_CL_CD
     , MBL_PROD_TYP_CD
 ORDER BY STRD_YM
     , SEX_CD
     , AGE_RNG_CD
     , PYFR_MBR_CL_CD
     , BTV_CNNT_SCRB_YN
     , CUSTGRP_CL_CD
     , MBL_PROD_TYP_CD
;


SELECT STRD_YM
     , (SELECT PPC_DC_TYP_NM FROM VM_PPC_DC_TYP AA WHERE A.PPC_DC_TYP_CD = AA.PPC_DC_TYP_CD) AS PPC_DC_TYP_NM
     , SVC_LAST_USE_MTH_CNT_RNG_CD
     , SUM(PT_COPN_ACCUM_AMT) AS PT_COPN_ACCUM_AMT
     , SUM(PT_COPN_USE_AMT_M) AS PT_COPN_USE_AMT_M
     , SUM(PT_COPN_USE_CNT_M) AS PT_COPN_USE_CNT_M
  FROM CT_PT_COPN_PRST_MONTH A
 GROUP BY STRD_YM
     , PPC_DC_TYP_CD
     , SVC_LAST_USE_MTH_CNT_RNG_CD
 ORDER BY STRD_YM
     , PPC_DC_TYP_CD
     , SVC_LAST_USE_MTH_CNT_RNG_CD
;


SELECT STRD_YM
     , (SELECT PPC_DC_TYP_NM FROM VM_PPC_DC_TYP AA WHERE A.PPC_DC_TYP_CD = AA.PPC_DC_TYP_CD) AS PPC_DC_TYP_NM
     , SUM(PT_COPN_ACCUM_AMT) AS PT_COPN_ACCUM_AMT
     , SUM(PT_COPN_USE_AMT_M) AS PT_COPN_USE_AMT_M
     , SUM(PT_COPN_USE_CNT_M) AS PT_COPN_USE_CNT_M
  FROM CT_MBL_PTCOPN_MONTH A
 GROUP BY STRD_YM
     , PPC_DC_TYP_CD
 ORDER BY STRD_YM
     , PPC_DC_TYP_CD
;


SELECT MAX(LENGTH(MAIN_MTH_FIXAMT_MT_SCRB)) FROM CT_PPM_MT_SCRB_DTL_MONTH PARTITION (PT_201506);
SELECT * FROM CT_PPM_MT_SCRB_DTL_MONTH PARTITION (PT_201506) WHERE LENGTH(MAIN_MTH_FIXAMT_MT_SCRB) = 26;


SELECT SVC_LAST_USE_MTH_CNT_RNG_CD, COUNT(*)
  FROM CC_SVC_PRST_MONTH PARTITION (PT_201506)
 GROUP BY SVC_LAST_USE_MTH_CNT_RNG_CD
 ORDER BY SVC_LAST_USE_MTH_CNT_RNG_CD;


SELECT SVC_LAST_USE_MTH_CNT_RNG_CD, COUNT(*)
  FROM CC_SVC_PRST_MONTH PARTITION (PT_201401)
 GROUP BY SVC_LAST_USE_MTH_CNT_RNG_CD
 ORDER BY SVC_LAST_USE_MTH_CNT_RNG_CD;
 
 
SELECT /*+ parallel(CC_SVC_PRST_MONTH 8) */ STRD_YM, SET_SCRB_YN, COUNT(*)
  FROM CC_SVC_PRST_MONTH
 GROUP BY STRD_YM, SET_SCRB_YN
 ORDER BY STRD_YM, SET_SCRB_YN;
 

SELECT /*+ parallel(CC_SVC_PRST_MONTH 8) */ STRD_YM, MSTB_YN, COUNT(*)
  FROM CC_SVC_PRST_MONTH
 GROUP BY STRD_YM, MSTB_YN
 ORDER BY STRD_YM, MSTB_YN;
 